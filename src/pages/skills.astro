---
import Icon from "../components/misc/Icon.astro";
import IconifyLoader from "../components/misc/IconifyLoader.astro";
import { siteConfig } from "../config";
import {
	professionalSkills,
	researchSkills,
	devToolsSkills,
	skillsData,
	getAdvancedSkills,
	getSkillStats,
	getTotalExperience,
} from "../data/skills";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";

import MainGridLayout from "../layouts/MainGridLayout.astro";

if (!siteConfig.featurePages.skills) {
	return Astro.redirect("/404/");
}

const stats = getSkillStats();
const advancedSkills = getAdvancedSkills();
const totalExperience = getTotalExperience();

const sections = [
	{ key: "professional", label: "Professional Skills", skills: professionalSkills },
	{ key: "research", label: "Research & Coding", skills: researchSkills },
	{ key: "dev-tools", label: "Frameworks & Tools", skills: devToolsSkills },
];

const education = [
	{
		degree: "Ph.D. in Applied Mathematics & AI",
		detail: "Focus: Solving Partial Differential Equations using Deep Learning.",
		period: "2023 — Present",
		active: true,
	},
	{
		degree: "M.Sc. in Mathematical Engineering",
		detail: "",
		period: "2021 — 2023",
		active: false,
	},
	{
		degree: "B.Sc. in Applied Mathematics",
		detail: "",
		period: "2018 — 2021",
		active: false,
	},
];

const career = [
	{
		role: "Offensive Security Researcher",
		detail: "The offensive side is where my curiosity runs deepest.",
		period: "Ongoing",
		active: true,
	},
	{
		role: "Security Engineer / SOC L2",
		detail: "Architecting defensive infrastructure: deploying EDR/XDR platforms, integrating SIEM solutions across multi-client environments, and leading security operations within Kubernetes-native infrastructure, from asset onboarding to full incident coordination.",
		period: "Apr 2024 — Present",
		active: true,
	},
	{
		role: "SOC Analyst L1",
		detail: "Where the journey started, alert triage, incident escalation, and real-time threat monitoring.",
		period: "Sep 2023 — Apr 2024",
		active: false,
	},
	{
		role: "AI Research — Internship",
		detail: "Built prediction models and constructed PDE-based systems from experimental data.",
		period: "Feb 2023 — Jun 2023",
		active: false,
	},
];

const getLevelColor = (level: string) => {
	switch (level) {
		case "expert":
			return "sk-badge-expert";
		case "advanced":
			return "sk-badge-advanced";
		case "intermediate":
			return "sk-badge-intermediate";
		case "beginner":
			return "sk-badge-beginner";
		default:
			return "sk-badge-default";
	}
};

const getLevelWidth = (level: string) => {
	switch (level) {
		case "expert": return "100%";
		case "advanced": return "80%";
		case "intermediate": return "60%";
		case "beginner": return "40%";
		default: return "20%";
	}
};

const title = i18n(I18nKey.skills);
const subtitle = i18n(I18nKey.skillsSubtitle);
const allIcons = skillsData.map((skill) => skill.icon).filter(Boolean);
---

<MainGridLayout title={title} description={subtitle}>
  <script is:inline>
    document.documentElement.setAttribute('data-page-type', 'skills');
  </script>
  
  <IconifyLoader preloadIcons={allIcons} />

  <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
    <div class="card-base z-10 px-9 py-6 relative w-full sk-page">

      <!-- ━━━ Academic Background ━━━ -->
      <section class="sk-section">
        <div class="sk-section-header">
          <h2 class="sk-heading">Academic Background</h2>
          <div class="sk-heading-line"></div>
        </div>
        <div class="tl-track">
          {education.map((edu, i) => (
            <div class={`tl-entry ${edu.active ? 'tl-active' : ''}`} style={`--delay: ${i * 80}ms`}>
              <div class="tl-rail">
                <span class={`tl-node ${edu.active ? 'tl-node-live' : ''}`}>
                  {edu.active && <span class="tl-pulse"></span>}
                </span>
                {i < education.length - 1 && <span class="tl-wire"></span>}
              </div>
              <div class="tl-body">
                <div class="tl-top">
                  <h3 class="tl-title">{edu.degree}</h3>
                  <span class={`tl-date ${edu.active ? 'tl-date-live' : ''}`}>{edu.period}</span>
                </div>
                {edu.detail && <p class="tl-desc">{edu.detail}</p>}
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- ━━━ Professional Experience ━━━ -->
      <section class="sk-section">
        <div class="sk-section-header">
          <h2 class="sk-heading">Professional Experience</h2>
          <div class="sk-heading-line"></div>
        </div>
        <div class="tl-track">
          {career.map((job, i) => (
            <div class={`tl-entry ${job.active ? 'tl-active' : ''}`} style={`--delay: ${i * 80}ms`}>
              <div class="tl-rail">
                <span class={`tl-node ${job.active ? 'tl-node-live' : ''}`}>
                  {job.active && <span class="tl-pulse"></span>}
                </span>
                {i < career.length - 1 && <span class="tl-wire"></span>}
              </div>
              <div class="tl-body">
                <div class="tl-top">
                  <h3 class="tl-title">{job.role}</h3>
                  <span class={`tl-date ${job.active ? 'tl-date-live' : ''}`}>{job.period}</span>
                </div>
                {job.detail && <p class="tl-desc">{job.detail}</p>}
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- ━━━ Skill Sections ━━━ -->
      <div class="sk-skills-wrap" style="container-type: inline-size;">
        {sections.map((section, sIdx) => {
          if (section.skills.length === 0) return null;
          
          return (
            <section class="sk-section">
              <div class="sk-section-header">
                <h2 class="sk-heading">
                  {section.label}
                  <span class="sk-count">{section.skills.length}</span>
                </h2>
                <div class="sk-heading-line"></div>
              </div>
              <div class="sk-grid">
                {section.skills.map((skill, i) => (
                  <div class="sk-card" style={`--delay: ${i * 40}ms; --accent: ${skill.color || 'rgb(99 102 241)'}`}>
                    <div class="sk-card-inner">
                      {skill.icon && (
                        <div class="sk-icon-wrap">
                          <Icon 
                            icon={skill.icon} 
                            class="text-lg" 
                            color={skill.color && skill.color !== '#000000' ? skill.color : 'rgb(99 102 241)'}
                            fallback={skill.name.charAt(0)}
                          />
                        </div>
                      )}
                      <div class="sk-card-body">
                        <div class="sk-card-top">
                          <h3 class="sk-name">{skill.name}</h3>
                          <span class={`sk-badge ${getLevelColor(skill.level)}`}>
                            {skill.level}
                          </span>
                        </div>
                        <p class="sk-desc">{skill.description}</p>
                        <div class="sk-bar-track">
                          <div 
                            class="sk-bar-fill"
                            style={`width: ${getLevelWidth(skill.level)};`}
                          ></div>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </section>
          );
        })}
      </div>

    </div>
  </div>
</MainGridLayout>

<style>
  /* ═══════════════════════════════════════════════════
     SKILLS PAGE — Redesigned
     ═══════════════════════════════════════════════════ */

  .sk-page {
    --sk-primary: var(--primary);
    --sk-radius: 10px;
    --sk-transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* ── Section Spacing ── */
  .sk-section {
    margin-bottom: 3.5rem;
  }
  .sk-section:last-child {
    margin-bottom: 0;
  }

  /* ── Section Header ── */
  .sk-section-header {
    margin-bottom: 1.75rem;
    position: relative;
  }
  .sk-heading {
    font-size: 1.35rem;
    font-weight: 750;
    letter-spacing: -0.02em;
    color: rgba(0, 0, 0, 0.88);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  :global(.dark) .sk-heading {
    color: rgba(255, 255, 255, 0.92);
  }
  .sk-heading-line {
    height: 2px;
    margin-top: 0.6rem;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--sk-primary), transparent 60%);
    opacity: 0.35;
  }
  :global(.dark) .sk-heading-line {
    opacity: 0.2;
  }
  .sk-count {
    font-size: 0.75rem;
    font-weight: 600;
    background: rgba(0, 0, 0, 0.06);
    color: rgba(0, 0, 0, 0.45);
    padding: 0.15rem 0.55rem;
    border-radius: 999px;
    letter-spacing: 0;
  }
  :global(.dark) .sk-count {
    background: rgba(255, 255, 255, 0.07);
    color: rgba(255, 255, 255, 0.4);
  }


  /* ═══════════════════════════════════════════════════
     TIMELINE — Refined
     ═══════════════════════════════════════════════════ */
  @keyframes tlSlideIn {
    from { opacity: 0; transform: translateX(-8px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  @keyframes tlPulse {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50%      { transform: scale(2.2); opacity: 0; }
  }

  .tl-track {
    display: flex;
    flex-direction: column;
    padding-left: 0.25rem;
  }
  .tl-entry {
    display: flex;
    gap: 1.25rem;
    animation: tlSlideIn 0.45s ease both;
    animation-delay: var(--delay, 0ms);
  }

  /* Rail (dot + line) */
  .tl-rail {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 14px;
    flex-shrink: 0;
    padding-top: 0.5rem;
  }
  .tl-node {
    width: 9px;
    height: 9px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.14);
    flex-shrink: 0;
    position: relative;
    transition: background var(--sk-transition), box-shadow var(--sk-transition);
  }
  :global(.dark) .tl-node {
    background: rgba(255, 255, 255, 0.14);
  }
  .tl-node-live {
    background: var(--sk-primary);
    box-shadow:
      0 0 0 3px rgba(var(--primary-rgb, 99, 102, 241), 0.12),
      0 0 8px rgba(var(--primary-rgb, 99, 102, 241), 0.18);
  }
  :global(.dark) .tl-node-live {
    box-shadow:
      0 0 0 3px rgba(var(--primary-rgb, 99, 102, 241), 0.18),
      0 0 10px rgba(var(--primary-rgb, 99, 102, 241), 0.25);
  }
  .tl-pulse {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: var(--sk-primary);
    animation: tlPulse 2.5s ease-in-out infinite;
    pointer-events: none;
  }
  .tl-wire {
    width: 1.5px;
    flex: 1;
    margin: 0.4rem 0;
    border-radius: 1px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.08), rgba(0,0,0,0.03));
  }
  :global(.dark) .tl-wire {
    background: linear-gradient(to bottom, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
  }

  /* Body */
  .tl-body {
    padding-bottom: 1.75rem;
    flex: 1;
    min-width: 0;
  }
  .tl-entry:last-child .tl-body {
    padding-bottom: 0;
  }
  .tl-top {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .tl-title {
    font-size: 0.925rem;
    font-weight: 650;
    color: rgba(0, 0, 0, 0.78);
    line-height: 1.35;
    letter-spacing: -0.005em;
  }
  :global(.dark) .tl-title {
    color: rgba(255, 255, 255, 0.82);
  }
  .tl-active .tl-title {
    color: rgba(0, 0, 0, 0.90);
  }
  :global(.dark) .tl-active .tl-title {
    color: rgba(255, 255, 255, 0.92);
  }
  .tl-date {
    font-size: 0.72rem;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.30);
    white-space: nowrap;
    letter-spacing: 0.02em;
    font-variant-numeric: tabular-nums;
  }
  :global(.dark) .tl-date {
    color: rgba(255, 255, 255, 0.25);
  }
  .tl-date-live {
    color: var(--sk-primary);
    font-weight: 650;
    opacity: 0.75;
  }
  :global(.dark) .tl-date-live {
    color: var(--sk-primary);
    opacity: 0.7;
  }
  .tl-desc {
    font-size: 0.8rem;
    color: rgba(0, 0, 0, 0.45);
    margin-top: 0.35rem;
    line-height: 1.6;
    font-style: italic;
    max-width: 48ch;
  }
  :global(.dark) .tl-desc {
    color: rgba(255, 255, 255, 0.35);
  }


  /* ═══════════════════════════════════════════════════
     SKILL CARDS — Glassmorphism
     ═══════════════════════════════════════════════════ */
  @keyframes skCardIn {
    from { opacity: 0; transform: translateY(10px) scale(0.98); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .sk-skills-wrap {
    position: relative;
  }
  .sk-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
    transition: grid-template-columns 0.3s ease;
  }
  @container (min-width: 42rem) { .sk-grid { grid-template-columns: repeat(2, 1fr); } }
  @container (min-width: 64rem) { .sk-grid { grid-template-columns: repeat(3, 1fr); } }

  .sk-card {
    animation: skCardIn 0.4s ease both;
    animation-delay: var(--delay, 0ms);
    --accent: rgb(99 102 241);
  }
  .sk-card-inner {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.9rem 1rem;
    border-radius: var(--sk-radius);
    border: 1px solid rgba(0, 0, 0, 0.07);
    background: rgba(255, 255, 255, 0.45);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    transition:
      border-color var(--sk-transition),
      box-shadow var(--sk-transition),
      transform var(--sk-transition),
      background var(--sk-transition);
    position: relative;
    overflow: hidden;
  }
  :global(.dark) .sk-card-inner {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.07);
  }

  /* Subtle accent glow on left edge */
  .sk-card-inner::before {
    content: '';
    position: absolute;
    left: 0;
    top: 20%;
    bottom: 20%;
    width: 2px;
    border-radius: 2px;
    background: var(--accent);
    opacity: 0;
    transition: opacity var(--sk-transition), top var(--sk-transition), bottom var(--sk-transition);
  }
  .sk-card:hover .sk-card-inner::before {
    opacity: 0.6;
    top: 12%;
    bottom: 12%;
  }

  .sk-card:hover .sk-card-inner {
    border-color: rgba(0, 0, 0, 0.12);
    box-shadow:
      0 2px 12px rgba(0, 0, 0, 0.05),
      0 0 0 1px rgba(0, 0, 0, 0.03);
    transform: translateY(-1px);
  }
  :global(.dark) .sk-card:hover .sk-card-inner {
    border-color: rgba(255, 255, 255, 0.12);
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.3),
      0 0 0 1px rgba(255, 255, 255, 0.05);
    background: rgba(255, 255, 255, 0.05);
  }

  /* Icon */
  .sk-icon-wrap {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    background: color-mix(in srgb, var(--accent) 10%, transparent);
    transition: transform var(--sk-transition);
  }
  .sk-card:hover .sk-icon-wrap {
    transform: scale(1.08);
  }

  /* Card body */
  .sk-card-body {
    flex: 1;
    min-width: 0;
  }
  .sk-card-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
  }
  .sk-name {
    font-size: 0.825rem;
    font-weight: 650;
    color: rgba(0, 0, 0, 0.82);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    letter-spacing: -0.005em;
  }
  :global(.dark) .sk-name {
    color: rgba(255, 255, 255, 0.85);
  }

  /* Badges */
  .sk-badge {
    font-size: 0.575rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 0.15rem 0.5rem;
    border-radius: 999px;
    white-space: nowrap;
    flex-shrink: 0;
    line-height: 1.5;
  }
  .sk-badge-expert {
    background: rgba(239, 68, 68, 0.1);
    color: rgba(220, 38, 38, 0.85);
  }
  :global(.dark) .sk-badge-expert {
    background: rgba(239, 68, 68, 0.12);
    color: rgba(252, 129, 129, 0.9);
  }
  .sk-badge-advanced {
    background: rgba(249, 115, 22, 0.1);
    color: rgba(234, 88, 12, 0.85);
  }
  :global(.dark) .sk-badge-advanced {
    background: rgba(249, 115, 22, 0.12);
    color: rgba(251, 146, 60, 0.9);
  }
  .sk-badge-intermediate {
    background: rgba(234, 179, 8, 0.1);
    color: rgba(161, 98, 7, 0.85);
  }
  :global(.dark) .sk-badge-intermediate {
    background: rgba(234, 179, 8, 0.1);
    color: rgba(250, 204, 21, 0.85);
  }
  .sk-badge-beginner {
    background: rgba(34, 197, 94, 0.1);
    color: rgba(22, 163, 74, 0.85);
  }
  :global(.dark) .sk-badge-beginner {
    background: rgba(34, 197, 94, 0.1);
    color: rgba(74, 222, 128, 0.85);
  }
  .sk-badge-default {
    background: rgba(0, 0, 0, 0.05);
    color: rgba(0, 0, 0, 0.4);
  }
  :global(.dark) .sk-badge-default {
    background: rgba(255, 255, 255, 0.06);
    color: rgba(255, 255, 255, 0.35);
  }

  /* Description */
  .sk-desc {
    font-size: 0.72rem;
    color: rgba(0, 0, 0, 0.42);
    line-height: 1.55;
    margin-bottom: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  :global(.dark) .sk-desc {
    color: rgba(255, 255, 255, 0.35);
  }

  /* Progress bar */
  .sk-bar-track {
    width: 100%;
    height: 3px;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.06);
    overflow: hidden;
  }
  :global(.dark) .sk-bar-track {
    background: rgba(255, 255, 255, 0.06);
  }
  .sk-bar-fill {
    height: 100%;
    border-radius: 3px;
    background: var(--accent);
    opacity: 0.65;
    transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
  }
  .sk-card:hover .sk-bar-fill {
    opacity: 0.9;
  }
</style>